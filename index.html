<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="speech.css">
    <title>Document</title>
</head>
<body>
    <section>
        <h1>Speech<br> Recognition</h1>
        <p>Available In ChromeðŸ˜Ž Only</p>
        <div class="container">
          <div class="texts">
          </div>
        </div>
    </section>
</body>
<script>
const texts = document.querySelector(".texts");

var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.interimResults = true;
recognition.lang = 'vi-VI' || 'en-US';
recognition.continuous = false

var synth = window.speechSynthesis;


let p = document.createElement("p");

let speak = async(text) => {
  let utter = new SpeechSynthesisUtterance(text);
  synth.speak(utter)
  utter.onerror = (err) => {
    console.error(err)
  }
}
let showText = (text) => {
  p= document.createElement("p");
  p.classList.add("replay");
  p.innerText = text;
  texts.appendChild(p);
}
var time = 1000;
recognition.addEventListener("result", (e) => {
  texts.appendChild(p);
  const text = Array.from(e.results)
    .map((result) => result[0])
    .map((result) => result.transcript)
    .join("");

  p.innerText = text;  
  if (e.results[0].isFinal) {
    if (text.includes("Xin chÃ o")) {
      showText("ChÃ o báº¡n");
      let replay = "good evening sir. how are you?";
      speak(replay);
      console.log(replay.length);
      time += replay.length *55;
      console.log(time);
    }
    if (text.includes("how are you")) {
      p = document.createElement("p");
      p.classList.add("replay");
      p.innerText = "I am fine";
      texts.appendChild(p);
    }
    if (
      text.includes("What's your name") ||
      text.includes("What is your name")
    ) {
      p = document.createElement("p");
      p.classList.add("replay");
      p.innerText = "My Name is Cifar";
      texts.appendChild(p);
    }
    if (text.includes("open my YouTube")) {
      p = document.createElement("p");
      p.classList.add("replay");
      p.innerText = "opening youtube channel";
      texts.appendChild(p);
      console.log("opening youtube");
      speak("opening youtube");
      window.open("https://www.youtube.com/channel/UCdxaLo9ALJgXgOUDURRPGiQ");
    }
    p = document.createElement("p");
  }
});

recognition.addEventListener("end", () => {
  setTimeout(() => {
    recognition.start();
    console.log('started');
    time = 0;
  }, time);
});

recognition.start();


</script>
</html>